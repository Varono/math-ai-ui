<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111827" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="format-detection" content="telephone=no" />
  <title>Î’Î¿Î·Î¸ÏŒÏ‚ ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÏÎ½ AI â€“ Î”Ï. ÎœÎ±ÏÎ¯Î½Î¿Ï‚ Î•Ï…ÏƒÏ„Î±Î¸Î¯Î¿Ï…</title>

  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    *{box-sizing:border-box}
    html{-webkit-text-size-adjust:100%}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:#f5f7fb;color:#111827;font-size:14px}
    main{width:100%;max-width:none;margin:0;padding:12px}

    h1{margin:4px 0 2px 0;font-size:1.2rem}
    .subtitle{margin:0 0 6px 0;font-size:.8rem;color:#4b5563}
    .edu-note-small{font-size:.75rem;color:#6b7280;margin-bottom:8px}

    .top-grid{display:grid;gap:10px}
    @media(min-width:980px){ .top-grid{grid-template-columns:1.35fr .65fr} }

    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 8px 20px rgba(15,23,42,.05);padding:10px;margin-bottom:10px}
    label{font-weight:800;font-size:.9rem}
    .muted{color:#64748b;font-size:.78rem}

    textarea,input[type="text"],input[type="number"]{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #d1d5db;font-family:"JetBrains Mono",ui-monospace,monospace;font-size:.9rem}
    textarea{min-height:70px}
    textarea:focus,input:focus{border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.12);outline:none}
    @media(max-width:650px){ textarea,input[type="text"],input[type="number"]{font-size:16px} }

    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}

    .btn{border:0;border-radius:999px;padding:6px 10px;font-weight:800;cursor:pointer;font-size:.8rem;touch-action:manipulation;white-space:nowrap}
    .btn.primary{background:#2563eb;color:#fff}
    .btn.ghost{background:#eef2ff;color:#1e3a8a}
    .btn.dark{background:#111827;color:#fff}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .divider{height:1px;background:#e5e7eb;margin:10px 0}

    #math-preview-box{margin-top:6px;border-radius:10px;border:1px dashed #cbd5e1;padding:6px 8px;background:#f9fafb;min-height:34px;font-size:.9rem;color:#0f172a}
    #math-preview-placeholder{color:#94a3b8;font-size:.75rem}
    .level-btn.active{background:#2563eb;color:#fff}

    .kbd{background:#eef2ff;border:1px solid #e5e7eb;border-radius:14px;padding:8px;margin-top:10px}
    .tabs{display:flex;gap:4px;flex-wrap:wrap}
    .tab{border:0;border-radius:999px;padding:4px 10px;background:#e5e7eb;cursor:pointer;font-weight:800;font-size:.75rem;touch-action:manipulation}
    .tab.active{background:#2563eb;color:#fff}
    .keys{margin-top:6px}
    .key{border:0;border-radius:9px;padding:6px 8px;background:#fff;margin:2px;cursor:pointer;font-family:"JetBrains Mono",ui-monospace,monospace;font-size:.75rem;box-shadow:0 1px 2px rgba(0,0,0,.12);touch-action:manipulation}

    .imgwrap{display:grid;gap:8px;margin-top:6px}
    .preview{width:100%;max-height:280px;object-fit:contain;border-radius:12px;border:1px dashed #cbd5e1;background:#fff}

    .answer{white-space:pre-wrap;border:1px solid #e5e7eb;border-radius:12px;padding:10px;min-height:80px;background:#fafafa;font-size:.9rem}
    #answer-card{scroll-margin-top:14px}

    .continue-box{margin-top:10px;border-top:1px solid #e5e7eb;padding-top:10px;display:none}
    .continue-q{font-weight:900;font-size:.85rem;margin-bottom:6px;color:#0f172a}

    .toast{
      position:fixed;left:50%;transform:translateX(-50%);bottom:14px;z-index:9999;
      background:rgba(17,24,39,.92);color:#fff;padding:10px 14px;border-radius:999px;
      box-shadow:0 12px 28px rgba(0,0,0,.22);display:none;align-items:center;gap:10px;
      max-width:92vw;font-size:.85rem;backdrop-filter: blur(6px);
    }
    .toast .toast-btn{
      border:0;background:#2563eb;color:#fff;font-weight:900;border-radius:999px;
      padding:8px 12px;cursor:pointer;touch-action:manipulation;white-space:nowrap;
    }

    .tools-header{display:flex;gap:10px;align-items:flex-end;justify-content:space-between;flex-wrap:wrap}
    .tool-tabs{display:flex;gap:6px;flex-wrap:wrap}
    .tool-tab{border:0;border-radius:999px;padding:8px 14px;background:#e5e7eb;cursor:pointer;font-weight:900;font-size:.82rem;touch-action:manipulation}
    .tool-tab.active{background:#111827;color:#fff}
    .tool-panel{display:none;margin-top:10px}
    .tool-panel.active{display:block}

    .mini-card{border:1px solid #e5e7eb;border-radius:14px;padding:10px;background:#fafafa;height:100%}
    .mini-title{font-weight:950;font-size:.86rem;margin-bottom:8px;color:#0f172a}
    .result-box{border:1px dashed #cbd5e1;border-radius:12px;padding:8px 10px;background:#fff;min-height:52px}
    .mono{font-family:"JetBrains Mono",ui-monospace,monospace}

    .matrix-wide{display:grid;gap:10px}
    @media(min-width:1100px){ .matrix-wide{grid-template-columns:1fr 1fr 1.25fr} }
    @media(min-width:820px) and (max-width:1099px){ .matrix-wide{grid-template-columns:1fr 1fr} }

    .two-col{display:grid;gap:10px}
    @media(min-width:920px){ .two-col{grid-template-columns:1.1fr .9fr} }

    .inline-inputs{display:grid;grid-template-columns:1fr 1fr;gap:8px;align-items:end}

    @media(max-width:650px){
      .btn{padding:10px 14px;font-size:14px}
      .tool-tab{padding:10px 14px}
      .tab{padding:8px 12px}
      .key{padding:10px 10px}
      .toast{font-size:14px}
      .toast .toast-btn{padding:10px 14px}
    }

    .footer-note{font-size:.78rem;color:#4b5563;line-height:1.4}

    /* --- Ink modal (STABLE) --- */
    .ink-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; z-index:9998; padding:18px;}
    .ink-backdrop.show{display:block;}
    .ink-modal{max-width:1100px; margin:0 auto; background:#fff; border-radius:16px; overflow:hidden; box-shadow:0 14px 40px rgba(0,0,0,.25); height:calc(100vh - 36px); display:flex; flex-direction:column; z-index:9999; position:relative;}
    .ink-header{background:#0f172a; color:#fff; padding:14px 16px; display:flex; align-items:center; gap:12px;}
    .ink-title{font-weight:800;}
    .ink-close{margin-left:auto; border:0; background:rgba(255,255,255,.14); color:#fff; padding:8px 12px; border-radius:999px; cursor:pointer;}
    .ink-body{padding:14px 16px; overflow:auto; flex:1; display:flex; flex-direction:column; gap:12px;}
    .ink-row{display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap;}
    .ink-col{flex:1; min-width:280px;}
    .ink-col-right{flex:0 0 420px; max-width:420px;}
    .ink-tools{display:flex; align-items:center; gap:10px; flex-wrap:wrap; background:#f1f5f9; border:1px solid #e2e8f0; border-radius:12px; padding:10px;}
    .tool{display:flex; align-items:center; gap:8px;}
    .tool-wide{flex:1; min-width:240px;}
    .tool input[type="range"]{width:100%;}
    .pill{display:inline-flex; align-items:center; justify-content:center; min-width:32px; height:28px; padding:0 8px; border-radius:999px; background:#fff; border:1px solid #dbeafe; font-weight:900;}
    .ink-actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    .ink-canvas-wrap{flex:1; min-height:min(62vh, 640px); height:min(62vh, 640px); border:1px dashed #cbd5e1; border-radius:14px; overflow:hidden; background:#fff;}
    #ink-canvas{width:100%; height:100%; display:block; touch-action:none; pointer-events:auto;}

    @media (max-width: 900px){
      .ink-col-right{flex:1; max-width:none;}
      .ink-modal{height:calc(100vh - 20px);}
      .ink-backdrop{padding:10px;}
    }
  </style>
</head>

<body>
<main>
  <h1>Î’Î¿Î·Î¸ÏŒÏ‚ ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÏÎ½ AI</h1>
  <p class="subtitle">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÏŒÏ‚: Î”Ï. ÎœÎ±ÏÎ¯Î½Î¿Ï‚ Î•Ï…ÏƒÏ„Î±Î¸Î¯Î¿Ï… â€“ ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÏŒÏ‚ (MSc) Î¼Îµ PhD ÏƒÏ„Î± Î Î±Î¹Î´Î±Î³Ï‰Î³Î¹ÎºÎ¬ / Î“Î½Ï‰ÏƒÏ„Î¹ÎºÎ® Î¨Ï…Ï‡Î¿Î»Î¿Î³Î¯Î±</p>
  <p class="edu-note-small">Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î±Ï…Ï„ÏŒ Î­Ï‡ÎµÎ¹ Î±Î½Î±Ï€Ï„Ï…Ï‡Î¸ÎµÎ¯ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î³Î¹Î± ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ¿ÏÏ‚ ÏƒÎºÎ¿Ï€Î¿ÏÏ‚.</p>

  <div class="top-grid">
    <div class="card">
      <label for="math-input">ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ® Î­ÎºÏ†ÏÎ±ÏƒÎ·</label>
      <textarea id="math-input" placeholder="Ï€.Ï‡. âˆ« x/(x+1) dx, ..."></textarea>

      <div id="math-preview-box">
        <span id="math-preview-placeholder">Î— Ï€ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÎµÎ´Ï ÎºÎ±Î¸ÏÏ‚ Î³ÏÎ¬Ï†ÎµÎ¹Ï‚â€¦</span>
        <div id="math-preview"></div>
      </div>

      <div style="margin-top:10px">
        <label for="text-input">Î›ÎµÎºÏ„Î¹ÎºÎ® Î±Ï€Î¿ÏÎ¯Î±</label>
        <textarea id="text-input" placeholder="Î¡ÏÏ„Î± ÎµÎ´Ï Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ (ÎºÎ±Î¹ Î³Î¹Î± Î Î¯Î½Î±ÎºÎµÏ‚/Î£ÎµÎ¹ÏÎ­Ï‚/Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ®)."></textarea>

        <div class="row" style="margin-top:4px">
          <span class="muted"><b>Î•Ï€Î¯Ï€ÎµÎ´Î¿ Î»ÏÏƒÎ·Ï‚:</b></span>
          <button class="btn ghost level-btn active" data-level="lyceum" type="button">Î›ÏÎºÎµÎ¹Î¿</button>
          <button class="btn ghost level-btn" data-level="university" type="button">Î Î±Î½ÎµÏ€Î¹ÏƒÏ„Î®Î¼Î¹Î¿</button>
        </div>

        <div class="row">
          <button class="btn primary" id="ask-btn" type="button">Î¡ÏÏ„Î± Ï„Î¿ AI</button>
          <button class="btn ghost" id="clear-btn" type="button">ÎšÎ±Î¸Î¬ÏÎ¹ÏƒÎµ</button>
          <span class="muted" id="status"></span>
        </div>
        <div class="muted">Endpoint: <b>/ask</b> (JSON).</div>
      </div>

      <div class="kbd">
        <div class="tabs">
          <button class="tab active" data-layout="num" type="button">123</button>
          <button class="tab" data-layout="func" type="button">f(x)</button>
          <button class="tab" data-layout="abc" type="button">ABC</button>
          <button class="tab" data-layout="sym" type="button">#&Â¬</button>
        </div>
        <div id="keyboard-rows" class="keys"></div>
      </div>
    </div>

    <div class="card">
      <label>ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î»ÏÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±</label>
      <div class="imgwrap">
        <input type="file" id="image-input" accept="image/*">
        <img id="img-preview" class="preview" alt="Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚" />
      </div>
      <div class="row">
        <button class="btn primary" id="check-image-btn" disabled type="button">ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚</button>
        <button class="btn ghost" id="remove-img-btn" disabled type="button">Î‘Ï†Î±Î¯ÏÎµÏƒÎ·</button>
      </div>

      <div class="card" style="margin-top:14px;">
        <div style="font-weight:950;margin-bottom:6px;">âœï¸ Î Î¯Î½Î±ÎºÎ±Ï‚ Î“ÏÎ±Ï†Î®Ï‚ (stylus / touch / mouse)</div>
        <div class="muted" style="margin:6px 0 10px;">
          Î™Î´Î±Î½Î¹ÎºÏŒ Î³Î¹Î± tablet/iPad Î±Î»Î»Î¬ Î´Î¿Ï…Î»ÎµÏÎµÎ¹ ÎºÎ±Î¹ ÏƒÎµ laptop Î¼Îµ Ï€Î¿Î½Ï„Î¯ÎºÎ¹. Î“ÏÎ¬Ï†ÎµÎ¹Ï‚ Î»ÏÏƒÎ· ÎºÎ±Î¹ Î¶Î·Ï„Î¬Ï‚ hint/Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·.
        </div>
        <button id="open-ink-btn" class="btn dark" type="button">âœï¸ Î†Î½Î¿Î¹Î¾Îµ Î Î¯Î½Î±ÎºÎ± Î“ÏÎ±Ï†Î®Ï‚</button>
      </div>

      <div class="muted">Î— Î¯Î´Î¹Î± Î»ÎµÎºÏ„Î¹ÎºÎ® Î±Ï€Î¿ÏÎ¯Î± ÎºÎ±Î¹ Ï„Î¿ Î¯Î´Î¹Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î¸Î± ÏƒÏ„Î±Î»Î¿ÏÎ½ Î¼Î±Î¶Î¯ Î¼Îµ Ï„Î· Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±.</div>
    </div>
  </div>

  <!-- (ÎŒÎ»Î¿ Ï„Î¿ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿ UI/ÎµÏÎ³Î±Î»ÎµÎ¯Î±/answer ÎºÏ„Î» Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î¯Î´Î¹Î¿ Î¼Îµ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ¿Ï…) -->
  <!-- Î“Î¹Î± Î½Î± Î¼Î·Î½ Ï„Î¿ ÎºÎ¬Î½Ï‰ Î´Î¹Ï€Î»Î¬-Ï„ÎµÏÎ¬ÏƒÏ„Î¹Î¿ ÎµÎ´Ï, ÎºÏÎ¬Ï„Î± Ï„Î¿ ÎºÎ¿Î¼Î¼Î¬Ï„Î¹ ÏƒÎ¿Ï… Î‘ÎšÎ¡Î™Î’Î©Î£ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ ÎµÎ¯Ï‡ÎµÏ‚ -->
  <!-- ================== START: Î‘Î ÎŸ Î•Î”Î© ÎšÎ‘ÎÎ• PASTE Î¤ÎŸ Î¥Î ÎŸÎ›ÎŸÎ™Î ÎŸ Î£ÎŸÎ¥ ÎœÎ•Î§Î¡Î™ Î Î¡Î™Î Î¤ÎŸ INK MODAL ================== -->

  <!-- âœ… Answer card with id -->
  <div class="card" id="answer-card">
    <label>Î‘Ï€Î¬Î½Ï„Î·ÏƒÎ· AI</label>
    <div id="ai-answer" class="answer">Î ÎµÏÎ¹Î¼Î­Î½Ï‰ Ï„Î·Î½ Ï€ÏÏÏ„Î· ÏƒÎ¿Ï… ÎµÏÏÏ„Î·ÏƒÎ·â€¦</div>

    <div id="continue-box" class="continue-box">
      <div class="continue-q">ÎÎ± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÏ‰;</div>
      <div class="row">
        <button class="btn dark" id="continue-yes" type="button">ÎÎ‘Î™</button>
        <button class="btn ghost" id="continue-no" type="button">ÎŸÎ§Î™</button>
        <span class="muted" id="continue-status"></span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="footer-note">
      <strong>Î£Î·Î¼Î±Î½Ï„Î¹ÎºÎ® ÏƒÎ·Î¼ÎµÎ¯Ï‰ÏƒÎ·:</strong><br>
      Î¤Î¿ Ï€Î±ÏÏŒÎ½ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Ï€ÏÎ¿Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ <strong>Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î³Î¹Î± ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ¿ÏÏ‚ ÏƒÎºÎ¿Ï€Î¿ÏÏ‚</strong>.
    </div>
  </div>
</main>

<div id="answer-toast" class="toast" role="status" aria-live="polite">
  <span>âœ… Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¿ ÎºÎ¬Ï„Ï‰.</span>
  <button id="toast-go" class="toast-btn" type="button">Î”ÎµÏ‚ Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·</button>
</div>

<script>
  const BASE_URL = "https://math-ai-server.onrender.com";

  /* ---------- Toast helpers ---------- */
  const toast = document.getElementById("answer-toast");
  const toastGo = document.getElementById("toast-go");
  const answerCard = document.getElementById("answer-card");

  function showToast(){
    toast.style.display = "flex";
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => hideToast(), 7000);
  }
  function hideToast(){ toast.style.display = "none"; }
  function isAnswerVisible(){
    const r = answerCard.getBoundingClientRect();
    const vh = window.innerHeight || document.documentElement.clientHeight;
    return (r.top < vh * 0.75) && (r.bottom > vh * 0.25);
  }
  function scrollToAnswer(){
    answerCard.scrollIntoView({ behavior: "smooth", block: "start" });
    hideToast();
  }
  toastGo.addEventListener("click", scrollToAnswer);
  window.addEventListener("scroll", () => {
    if (toast.style.display !== "none" && isAnswerVisible()) hideToast();
  }, { passive:true });

  /* --------- (ÎšÎ¡Î‘Î¤Î‘ Î¤ÎŸ Î”Î™ÎšÎŸ Î£ÎŸÎ¥ SCRIPT Î•Î”Î©: level, keyboard, askAI, photo, tools ÎºÏ„Î») --------- */
</script>

<!-- INK MODAL -->
<div id="ink-backdrop" class="ink-backdrop" aria-hidden="true">
  <div id="ink-modal" class="ink-modal" role="dialog" aria-modal="true" aria-label="Î Î¯Î½Î±ÎºÎ±Ï‚ Î³ÏÎ±Ï†Î®Ï‚">
    <div class="ink-header">
      <div class="ink-title">âœï¸ Î Î¯Î½Î±ÎºÎ±Ï‚ Î“ÏÎ±Ï†Î®Ï‚ â€“ Î³ÏÎ¬ÏˆÎµ Î¬Î½ÎµÏ„Î± Î¼Îµ Ï€Î­Î½Î±/Î´Î¬Ï‡Ï„Ï…Î»Î¿/Ï€Î¿Î½Ï„Î¯ÎºÎ¹</div>
      <button id="ink-close" class="ink-close" type="button">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ âœ•</button>
    </div>

    <div class="ink-body">
      <div class="ink-row">
        <div class="ink-col">
          <div style="font-weight:900;margin-bottom:6px;">Î›ÎµÎºÏ„Î¹ÎºÎ® Î±Ï€Î¿ÏÎ¯Î± Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ Î²Î®Î¼Î±</div>
          <textarea id="ink-question" rows="2" placeholder="Ï€.Ï‡. Î³Î¹Î±Ï„Î¯ ÎµÎ´Ï Î±Î»Î»Î¬Î¶ÎµÎ¹ Ï€ÏÏŒÏƒÎ·Î¼Î¿; / Î¼Ï€Î¿ÏÏ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ‰ Î±Î½Ï„Î¹ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·;"></textarea>
        </div>
        <div class="ink-col ink-col-right">
          <div style="font-weight:900;margin-bottom:6px;">Î•ÏÎ³Î±Î»ÎµÎ¯Î± Î³ÏÎ±Ï†Î®Ï‚</div>
          <div class="ink-tools">
            <label class="tool">
              <span>Î§ÏÏÎ¼Î±</span>
              <input id="ink-color" type="color" value="#000000">
            </label>

            <label class="tool tool-wide">
              <span>Î Î¬Ï‡Î¿Ï‚</span>
              <input id="ink-size" type="range" min="1" max="18" value="4" step="1">
              <span id="ink-size-val" class="pill">4</span>
            </label>

            <button id="ink-clear" class="btn ghost" type="button">ğŸ§½ ÎšÎ±Î¸Î¬ÏÎ¹ÏƒÎµ</button>
          </div>
        </div>
      </div>

      <div class="ink-actions">
        <button id="ink-check" class="btn primary" type="button">âœ… ÎˆÎ»ÎµÎ³Î¾Îµ Î²Î®Î¼Î±</button>
        <button id="ink-hint" class="btn ghost" type="button">ğŸ’­ Î”ÏÏƒÎµ hint</button>
        <div class="muted" style="margin-left:auto;">Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¼Îµ Ï€Î¿Î½Ï„Î¯ÎºÎ¹, touch ÎºÎ±Î¹ stylus.</div>
      </div>

      <div class="ink-canvas-wrap" id="ink-wrap">
        <canvas id="ink-canvas"></canvas>
      </div>

      <div id="ink-status" class="muted" style="margin-top:10px;"></div>
    </div>
  </div>
</div>

<script>
/* ===== INK MODAL JS: PointerEvents-only + ResizeObserver (Render-stable) ===== */
(function(){
  const qs = (id)=>document.getElementById(id);

  const backdrop = qs("ink-backdrop");
  const closeBtn = qs("ink-close");
  const openBtn  = qs("open-ink-btn");
  const canvas   = qs("ink-canvas");
  const wrap     = qs("ink-wrap");

  const colorEl  = qs("ink-color");
  const sizeEl   = qs("ink-size");
  const sizeVal  = qs("ink-size-val");
  const clearBtn = qs("ink-clear");

  let ctx = null;
  let drawing = false;
  let activePointerId = null;

  function ensureCtx(){
    if(!ctx) ctx = canvas.getContext("2d");
    return ctx;
  }

  function setStyle(){
    const c = ensureCtx();
    const color = (colorEl && colorEl.value) ? colorEl.value : "#000000";
    const size  = sizeEl ? parseInt(sizeEl.value || "4", 10) : 4;

    if(sizeVal) sizeVal.textContent = String(size);

    c.strokeStyle = color;
    c.lineWidth = size;
    c.lineCap = "round";
    c.lineJoin = "round";
  }

  function resizeCanvas(){
    if(!wrap) return;
    const rect = wrap.getBoundingClientRect();
    const w = Math.floor(rect.width);
    const h = Math.floor(rect.height);
    if(w < 50 || h < 50) return; // avoid 0x0

    const dpr = window.devicePixelRatio || 1;

    // ÎºÏÎ±Ï„Î¬Î¼Îµ Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ drawing ÏƒÎ±Î½ ÎµÎ¹ÎºÏŒÎ½Î±
    const temp = document.createElement("canvas");
    temp.width = canvas.width;
    temp.height = canvas.height;
    const tctx = temp.getContext("2d");
    tctx.drawImage(canvas, 0, 0);

    canvas.width  = Math.floor(w * dpr);
    canvas.height = Math.floor(h * dpr);
    canvas.style.width = w + "px";
    canvas.style.height = h + "px";

    ctx = canvas.getContext("2d");
    ctx.setTransform(dpr,0,0,dpr,0,0);

    setStyle();

    // ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ Ï€Î±Î»Î¹Î¿Ï drawing (ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· ÏƒÏ„Î¿ Î½Î­Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚)
    if(temp.width && temp.height){
      ctx.drawImage(temp, 0, 0, temp.width, temp.height, 0, 0, w, h);
    }
  }

  function pos(ev){
    const r = canvas.getBoundingClientRect();
    return { x: ev.clientX - r.left, y: ev.clientY - r.top };
  }

  function start(ev){
    setStyle();
    const c = ensureCtx();
    drawing = true;
    activePointerId = ev.pointerId;
    canvas.setPointerCapture(activePointerId);

    const p = pos(ev);
    c.beginPath();
    c.moveTo(p.x, p.y);
    ev.preventDefault();
  }

  function move(ev){
    if(!drawing) return;
    if(ev.pointerId !== activePointerId) return;
    const c = ensureCtx();
    const p = pos(ev);
    c.lineTo(p.x, p.y);
    c.stroke();
    ev.preventDefault();
  }

  function end(ev){
    if(!drawing) return;
    if(ev.pointerId !== activePointerId) return;
    drawing = false;
    try{ canvas.releasePointerCapture(activePointerId); }catch(e){}
    activePointerId = null;
    ev.preventDefault();
  }

  function open(){
    backdrop.classList.add("show");
    backdrop.setAttribute("aria-hidden","false");
    // 2-pass resize Î³Î¹Î± Î½Î± â€œÏ€Î¹Î¬ÏƒÎµÎ¹â€ ÏƒÏ‰ÏƒÏ„Î¬ ÏƒÎµ Render/Chrome
    requestAnimationFrame(()=>{
      resizeCanvas();
      setTimeout(resizeCanvas, 80);
      setTimeout(resizeCanvas, 220);
    });
  }

  function close(){
    backdrop.classList.remove("show");
    backdrop.setAttribute("aria-hidden","true");
    drawing = false;
    activePointerId = null;
  }

  function clear(){
    const c = ensureCtx();
    c.clearRect(0,0, canvas.width, canvas.height);
  }

  // Bind once
  openBtn.addEventListener("click", open);
  closeBtn.addEventListener("click", close);

  backdrop.addEventListener("click", (e)=>{
    if(e.target === backdrop) close();
  });

  canvas.addEventListener("pointerdown", start, {passive:false});
  canvas.addEventListener("pointermove", move,  {passive:false});
  canvas.addEventListener("pointerup", end,     {passive:false});
  canvas.addEventListener("pointercancel", end, {passive:false});
  canvas.addEventListener("pointerleave", end,  {passive:false});

  if(sizeEl)  sizeEl.addEventListener("input", setStyle);
  if(colorEl) colorEl.addEventListener("input", setStyle);
  if(clearBtn) clearBtn.addEventListener("click", clear);

  // ResizeObserver = ÏƒÏ„Î±Î¸ÎµÏÏŒ ÏƒÎµ modal/layout changes
  if(window.ResizeObserver && wrap){
    const ro = new ResizeObserver(()=> {
      if(backdrop.classList.contains("show")) resizeCanvas();
    });
    ro.observe(wrap);
  }

  window.addEventListener("resize", ()=>{
    if(backdrop.classList.contains("show")) resizeCanvas();
  });

  // init style
  setStyle();
})();
</script>

</body>
</html>
