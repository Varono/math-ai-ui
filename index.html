<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111827" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="format-detection" content="telephone=no" />
  <title>Î’Î¿Î·Î¸ÏŒÏ‚ ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÏÎ½ AI â€“ Î”Ï. ÎœÎ±ÏÎ¯Î½Î¿Ï‚ Î•Ï…ÏƒÏ„Î±Î¸Î¯Î¿Ï…</title>

  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    *{box-sizing:border-box}
    html{-webkit-text-size-adjust:100%}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:#f5f7fb;color:#111827;font-size:14px}
    main{width:100%;max-width:none;margin:0;padding:12px}

    h1{margin:4px 0 2px 0;font-size:1.2rem}
    .subtitle{margin:0 0 6px 0;font-size:.8rem;color:#4b5563}
    .edu-note-small{font-size:.75rem;color:#6b7280;margin-bottom:8px}

    .top-grid{display:grid;gap:10px}
    @media(min-width:980px){ .top-grid{grid-template-columns:1.35fr .65fr} }

    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 8px 20px rgba(15,23,42,.05);padding:10px;margin-bottom:10px}
    label{font-weight:800;font-size:.9rem}
    .muted{color:#64748b;font-size:.78rem}

    textarea,input[type="text"],input[type="number"]{
      width:100%;padding:8px 10px;border-radius:10px;border:1px solid #d1d5db;
      font-family:"JetBrains Mono",ui-monospace,monospace;font-size:.9rem
    }
    textarea{min-height:70px}
    textarea:focus,input:focus{border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.12);outline:none}
    @media(max-width:650px){ textarea,input[type="text"],input[type="number"]{font-size:16px} }

    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}

    .btn{border:0;border-radius:999px;padding:6px 10px;font-weight:800;cursor:pointer;font-size:.8rem;touch-action:manipulation;white-space:nowrap}
    .btn.primary{background:#2563eb;color:#fff}
    .btn.ghost{background:#eef2ff;color:#1e3a8a}
    .btn.dark{background:#111827;color:#fff}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .divider{height:1px;background:#e5e7eb;margin:10px 0}

    #math-preview-box{margin-top:6px;border-radius:10px;border:1px dashed #cbd5e1;padding:6px 8px;background:#f9fafb;min-height:34px;font-size:.9rem;color:#0f172a}
    #math-preview-placeholder{color:#94a3b8;font-size:.75rem}

    .level-btn.active{background:#2563eb;color:#fff}

    .kbd{background:#eef2ff;border:1px solid #e5e7eb;border-radius:14px;padding:8px;margin-top:10px}
    .tabs{display:flex;gap:4px;flex-wrap:wrap}
    .tab{border:0;border-radius:999px;padding:4px 10px;background:#e5e7eb;cursor:pointer;font-weight:800;font-size:.75rem;touch-action:manipulation}
    .tab.active{background:#2563eb;color:#fff}
    .keys{margin-top:6px}
    .key{
      border:0;border-radius:9px;padding:6px 8px;background:#fff;margin:2px;cursor:pointer;
      font-family:"JetBrains Mono",ui-monospace,monospace;font-size:.75rem;box-shadow:0 1px 2px rgba(0,0,0,.12);
      touch-action:manipulation
    }

    .imgwrap{display:grid;gap:8px;margin-top:6px}
    .preview{width:100%;max-height:280px;object-fit:contain;border-radius:12px;border:1px dashed #cbd5e1;background:#fff}

    .answer{
      white-space:pre-wrap;border:1px solid #e5e7eb;border-radius:12px;padding:10px;min-height:80px;background:#fafafa;font-size:.9rem;
      word-break: normal; overflow-wrap: anywhere;
    }
    #answer-card{scroll-margin-top:14px}

    .continue-box{margin-top:10px;border-top:1px solid #e5e7eb;padding-top:10px;display:none}
    .continue-q{font-weight:900;font-size:.85rem;margin-bottom:6px;color:#0f172a}

    .toast{
      position:fixed;left:50%;transform:translateX(-50%);bottom:14px;z-index:9999;
      background:rgba(17,24,39,.92);color:#fff;padding:10px 14px;border-radius:999px;
      box-shadow:0 12px 28px rgba(0,0,0,.22);display:none;align-items:center;gap:10px;
      max-width:92vw;font-size:.85rem;backdrop-filter: blur(6px);
    }
    .toast .toast-btn{
      border:0;background:#2563eb;color:#fff;font-weight:900;border-radius:999px;padding:8px 12px;
      cursor:pointer;touch-action:manipulation;white-space:nowrap;
    }

    .tools-header{display:flex;gap:10px;align-items:flex-end;justify-content:space-between;flex-wrap:wrap}
    .tool-tabs{display:flex;gap:6px;flex-wrap:wrap}
    .tool-tab{border:0;border-radius:999px;padding:8px 14px;background:#e5e7eb;cursor:pointer;font-weight:900;font-size:.82rem;touch-action:manipulation}
    .tool-tab.active{background:#111827;color:#fff}
    .tool-panel{display:none;margin-top:10px}
    .tool-panel.active{display:block}

    .mini-card{border:1px solid #e5e7eb;border-radius:14px;padding:10px;background:#fafafa;height:100%}
    .mini-title{font-weight:950;font-size:.86rem;margin-bottom:8px;color:#0f172a}
    .result-box{border:1px dashed #cbd5e1;border-radius:12px;padding:8px 10px;background:#fff;min-height:52px}
    .mono{font-family:"JetBrains Mono",ui-monospace,monospace}

    .matrix-wide{display:grid;gap:10px}
    @media(min-width:1100px){ .matrix-wide{grid-template-columns:1fr 1fr 1.25fr} }
    @media(min-width:820px) and (max-width:1099px){ .matrix-wide{grid-template-columns:1fr 1fr} }

    .two-col{display:grid;gap:10px}
    @media(min-width:920px){ .two-col{grid-template-columns:1.1fr .9fr} }

    .inline-inputs{display:grid;grid-template-columns:1fr 1fr;gap:8px;align-items:end}

    @media(max-width:650px){
      .btn{padding:10px 14px;font-size:14px}
      .tool-tab{padding:10px 14px}
      .tab{padding:8px 12px}
      .key{padding:10px 10px}
      .toast{font-size:14px}
      .toast .toast-btn{padding:10px 14px}
    }

    .footer-note{font-size:.78rem;color:#4b5563;line-height:1.4}

    .answer-actions{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
      margin-top:10px;
    }
    .answer-actions .btn{padding:8px 12px;font-size:.8rem}
    .answer-actions .pill{
      font-size:.75rem; color:#64748b;
      border:1px solid #e5e7eb; background:#fff; padding:6px 10px; border-radius:999px;
    }

    /* ===== Ink Modal ===== */
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(15,23,42,.55);
      display:none;
      z-index:10000;
      padding:12px;
      overflow:auto;
    }
    .modal-backdrop.show{display:block;}
    .modal{
      width:min(1200px, 96vw);
      margin:24px auto;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:18px;
      box-shadow:0 20px 50px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .modal-head{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;background:#0f172a;color:#fff;
    }
    .modal-title{font-weight:950; font-size:.92rem;}
    .modal-close{
      border:0;background:rgba(255,255,255,.14);color:#fff;border-radius:999px;
      padding:8px 12px;cursor:pointer;font-weight:900;
    }
    .modal-body{padding:10px 12px;}

    .ink-controls{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      padding:8px 10px;border:1px solid #e5e7eb;border-radius:14px;background:#fafafa;margin:8px 0 10px 0;
    }
    .ink-controls label{font-weight:900;font-size:.78rem;margin-right:6px}
    .ink-controls .ctrl{display:flex;align-items:center;gap:8px}
    .ink-controls input[type="range"]{width:170px}
    .ink-controls input[type="color"]{width:42px;height:30px;padding:0;border:0;background:transparent;cursor:pointer}
    .ink-controls .val{font-family:"JetBrains Mono",ui-monospace,monospace;font-size:.78rem;color:#334155;min-width:38px;text-align:left}

    .ink-split{display:grid;gap:12px;margin-top:10px}
    @media(min-width:980px){ .ink-split{ grid-template-columns:1fr 1fr; } }

    .ink-pane{
      border:1px solid #e5e7eb;
      border-radius:16px;
      background:#fafafa;
      padding:10px;
    }
    .ink-pane-title{
      font-weight:950;
      font-size:.88rem;
      color:#0f172a;
      margin-bottom:8px;
      display:flex; align-items:center; gap:8px;
    }

    .ink-wrap{
      border:1px dashed #cbd5e1;border-radius:14px;background:#fff;
      height:min(52vh, 520px);width:100%;overflow:hidden;position:relative;
      touch-action:none;
    }
    canvas.ink-canvas{
      width:100%;height:100%;display:block;background:#fff;
      cursor:crosshair;user-select:none;-webkit-user-select:none;touch-action:none;
    }

    .ink-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:10px}
    .ink-tip{font-size:.78rem;color:#475569;margin-top:8px}

    .status-thinking{
      color:#dc2626 !important;
      font-weight:950;
      font-size:.92rem;
    }
    #ink-transfer-status{
      margin-top:8px;
      font-weight:950;
      font-size:1rem;
      color:#dc2626;
    }

    @media print{
      .toast, .kbd, .tool-tabs, .tools-header, .tool-panel, #open-ink-btn,
      #image-input, #check-image-btn, #remove-img-btn, #continue-box,
      .answer-actions, #status, .edu-note-small, .subtitle { display:none !important; }
      body{background:#fff}
      main{padding:0}
      .card{box-shadow:none;border:0;border-radius:0;margin:0;padding:0}
      #ai-answer{border:0;background:#fff;padding:0}
    }
  </style>
</head>

<body>
<main>
  <h1>Î’Î¿Î·Î¸ÏŒÏ‚ ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÏÎ½ AI</h1>
  <p class="subtitle">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÏŒÏ‚: Î”Ï. ÎœÎ±ÏÎ¯Î½Î¿Ï‚ Î•Ï…ÏƒÏ„Î±Î¸Î¯Î¿Ï… â€“ ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÏŒÏ‚ (MSc) Î¼Îµ PhD ÏƒÏ„Î± Î Î±Î¹Î´Î±Î³Ï‰Î³Î¹ÎºÎ¬ / Î“Î½Ï‰ÏƒÏ„Î¹ÎºÎ® Î¨Ï…Ï‡Î¿Î»Î¿Î³Î¯Î±</p>
  <p class="edu-note-small">Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î±Ï…Ï„ÏŒ Î­Ï‡ÎµÎ¹ Î±Î½Î±Ï€Ï„Ï…Ï‡Î¸ÎµÎ¯ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î³Î¹Î± ÎµÎºÏ€Î±Î¹Î´ÎµÏ…Ï„Î¹ÎºÎ¿ÏÏ‚ ÏƒÎºÎ¿Ï€Î¿ÏÏ‚.</p>

  <div class="top-grid">
    <div class="card">
      <label for="math-input">ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ® Î­ÎºÏ†ÏÎ±ÏƒÎ·</label>
      <textarea id="math-input" placeholder="Ï€.Ï‡. âˆ« x/(x+1) dx, ..."></textarea>

      <div id="math-preview-box">
        <span id="math-preview-placeholder">Î— Ï€ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÎµÎ´Ï ÎºÎ±Î¸ÏÏ‚ Î³ÏÎ¬Ï†ÎµÎ¹Ï‚â€¦</span>
        <div id="math-preview"></div>
      </div>

      <div style="margin-top:10px">
        <label for="text-input">Î›ÎµÎºÏ„Î¹ÎºÎ® Î±Ï€Î¿ÏÎ¯Î±</label>
        <textarea id="text-input" placeholder="Î¡ÏÏ„Î± ÎµÎ´Ï Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ (ÎºÎ±Î¹ Î³Î¹Î± Î Î¯Î½Î±ÎºÎµÏ‚/Î£ÎµÎ¹ÏÎ­Ï‚/Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ®)."></textarea>

        <div class="row" style="margin-top:4px">
          <span class="muted"><b>Î•Ï€Î¯Ï€ÎµÎ´Î¿ Î»ÏÏƒÎ·Ï‚:</b></span>
          <button class="btn ghost level-btn active" data-level="lyceum" type="button">Î›ÏÎºÎµÎ¹Î¿</button>
          <button class="btn ghost level-btn" data-level="university" type="button">Î Î±Î½ÎµÏ€Î¹ÏƒÏ„Î®Î¼Î¹Î¿</button>
        </div>

        <!-- âœ… NEW: two separate clear buttons -->
        <div class="row">
          <button class="btn primary" id="ask-btn" type="button">Î¡ÏÏ„Î± Ï„Î¿ AI</button>
          <button class="btn ghost" id="clear-math-btn" type="button">ğŸ§¼ ÎšÎ±Î¸Î¬ÏÎ¹ÏƒÎµ ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ®</button>
          <button class="btn ghost" id="clear-text-btn" type="button">ğŸ§¼ ÎšÎ±Î¸Î¬ÏÎ¹ÏƒÎµ Î›ÎµÎºÏ„Î¹ÎºÎ®</button>
          <span class="muted" id="status"></span>
        </div>

        <div class="muted">Endpoint: <b>/ask</b> (JSON) & <b>/check-image</b> (FormData).</div>
      </div>

      <div class="kbd">
        <div class="tabs">
          <button class="tab active" data-layout="num" type="button">123</button>
          <button class="tab" data-layout="func" type="button">f(x)</button>
          <button class="tab" data-layout="abc" type="button">ABC</button>
          <button class="tab" data-layout="sym" type="button">#&Â¬</button>
        </div>
        <div id="keyboard-rows" class="keys"></div>
      </div>
    </div>

    <div class="card">
      <label>ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î»ÏÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±</label>
      <div class="imgwrap">
        <input type="file" id="image-input" accept="image/*">
        <img id="img-preview" class="preview" alt="Î ÏÎ¿ÎµÏ€Î¹ÏƒÎºÏŒÏ€Î·ÏƒÎ· Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚" />
      </div>
      <div class="row">
        <button class="btn primary" id="check-image-btn" disabled type="button">ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚</button>
        <button class="btn ghost" id="remove-img-btn" disabled type="button">Î‘Ï†Î±Î¯ÏÎµÏƒÎ·</button>
      </div>
      <div class="muted">Î— Î¯Î´Î¹Î± Î»ÎµÎºÏ„Î¹ÎºÎ® Î±Ï€Î¿ÏÎ¯Î± ÎºÎ±Î¹ Ï„Î¿ Î¯Î´Î¹Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î¸Î± ÏƒÏ„Î±Î»Î¿ÏÎ½ Î¼Î±Î¶Î¯ Î¼Îµ Ï„Î· Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±.</div>

      <div class="divider"></div>

      <div class="row">
        <button class="btn dark" id="open-ink-btn" type="button">âœï¸ Î†Î½Î¿Î¹Î¾Îµ Î Î¯Î½Î±ÎºÎ± Î“ÏÎ±Ï†Î®Ï‚ (stylus)</button>
        <span class="muted">Î™Î´Î±Î½Î¹ÎºÏŒ Î³Î¹Î± tablet/iPad: Î³ÏÎ¬Ï†ÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï„Î¿ Ï€ÎµÏÎ½Î¬Ï‚ ÏƒÏ„Î± Ï€ÎµÎ´Î¯Î±.</span>
      </div>
    </div>
  </div>

  <div class="card" id="answer-card">
    <label>Î‘Ï€Î¬Î½Ï„Î·ÏƒÎ· AI</label>
    <div id="ai-answer" class="answer">Î ÎµÏÎ¹Î¼Î­Î½Ï‰ Ï„Î·Î½ Ï€ÏÏÏ„Î· ÏƒÎ¿Ï… ÎµÏÏÏ„Î·ÏƒÎ·â€¦</div>
  </div>
</main>

<div id="answer-toast" class="toast" role="status" aria-live="polite">
  <span>âœ… Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¿ ÎºÎ¬Ï„Ï‰.</span>
  <button id="toast-go" class="toast-btn" type="button">Î”ÎµÏ‚ Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·</button>
</div>

<div id="ink-backdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Î Î¯Î½Î±ÎºÎ±Ï‚ Î“ÏÎ±Ï†Î®Ï‚">
    <div class="modal-head">
      <div class="modal-title">âœï¸ Î Î¯Î½Î±ÎºÎ±Ï‚ Î“ÏÎ±Ï†Î®Ï‚ â€” Î³ÏÎ¬ÏˆÎµ (ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬ / Î›ÎµÎºÏ„Î¹ÎºÎ¬) ÎºÎ±Î¹ Ï€Î­ÏÎ±ÏƒÎ­ Ï„Î± ÏƒÏ„Î± Ï€ÎµÎ´Î¯Î±</div>
      <button class="modal-close" id="ink-close" type="button">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ âœ•</button>
    </div>

    <div class="modal-body">
      <div class="ink-controls">
        <div class="ctrl">
          <label for="ink-color">Î§ÏÏÎ¼Î±</label>
          <input id="ink-color" type="color" value="#111827" />
        </div>
        <div class="ctrl">
          <label for="ink-size">Î Î¬Ï‡Î¿Ï‚</label>
          <input id="ink-size" type="range" min="1" max="16" step="1" value="4" />
          <span class="val" id="ink-size-val">4</span>
        </div>
        <span class="muted">Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¼Îµ Ï€Î¿Î½Ï„Î¯ÎºÎ¹, touch ÎºÎ±Î¹ stylus.</span>
      </div>

      <div class="ink-split">
        <div class="ink-pane">
          <div class="ink-pane-title">ğŸ§® Î“ÏÎ¬ÏˆÎµ ÎœÎ‘Î˜Î—ÎœÎ‘Î¤Î™ÎšÎ— Î­ÎºÏ†ÏÎ±ÏƒÎ·</div>
          <div class="ink-wrap">
            <canvas id="ink-math-canvas" class="ink-canvas"></canvas>
          </div>
          <div class="ink-actions">
            <button class="btn primary" id="ink-math-to-main" type="button">â¡ï¸ Î Î­ÏÎ±ÏƒÎµ ÏƒÏ„Î· ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ® ÎˆÎºÏ†ÏÎ±ÏƒÎ·</button>
            <button class="btn ghost" id="ink-math-clear" type="button">ğŸ§¼ ÎšÎ±Î¸Î¬ÏÎ¹ÏƒÎµ</button>
          </div>
          <div class="ink-tip">Tip: Î³ÏÎ¬ÏˆÎµ ÎºÎ±Î¸Î±ÏÎ¬ (Ï€.Ï‡. ÎºÎ»Î¬ÏƒÎ¼Î±Ï„Î± ÏƒÎµ â€œÏ€Î¬Î½Ï‰/ÎºÎ¬Ï„Ï‰â€).</div>
        </div>

        <div class="ink-pane">
          <div class="ink-pane-title">ğŸ’¬ Î“ÏÎ¬ÏˆÎµ Î›Î•ÎšÎ¤Î™ÎšÎ— Î±Ï€Î¿ÏÎ¯Î±</div>
          <div class="ink-wrap">
            <canvas id="ink-text-canvas" class="ink-canvas"></canvas>
          </div>
          <div class="ink-actions">
            <button class="btn primary" id="ink-text-to-main" type="button">â¡ï¸ Î Î­ÏÎ±ÏƒÎµ ÏƒÏ„Î· Î›ÎµÎºÏ„Î¹ÎºÎ® Î‘Ï€Î¿ÏÎ¯Î±</button>
            <button class="btn ghost" id="ink-text-clear" type="button">ğŸ§¼ ÎšÎ±Î¸Î¬ÏÎ¹ÏƒÎµ</button>
          </div>
          <div class="ink-tip">Tip: Î³ÏÎ¬ÏˆÎµ Î¼Î¹ÎºÏÎ­Ï‚ Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚/Î»Î­Î¾ÎµÎ¹Ï‚ (ÏŒÏ‡Î¹ Ï„ÎµÏÎ¬ÏƒÏ„Î¹Î¿ Ï€Î±ÏÎ¬Î³ÏÎ±Ï†Î¿).</div>
        </div>
      </div>

      <div class="divider"></div>
      <div class="muted">
        Î Î±Ï„Î¬Ï‚ â€œÎ Î­ÏÎ±ÏƒÎµâ€¦â€ Î³Î¹Î± Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÎºÎ±Î¹ Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬. ÎœÎµÏ„Î¬, Ï€Î±Ï„Î¬Ï‚ <b>â€œÎ¡ÏÏ„Î± Ï„Î¿ AIâ€</b> Î±Ï€ÏŒ Ï„Î·Î½ ÎºÏÏÎ¹Î± ÏƒÎµÎ»Î¯Î´Î±.
      </div>
      <div class="muted" id="ink-transfer-status"></div>
    </div>
  </div>
</div>

<script>
  const BASE_URL = "https://math-ai-server.onrender.com";

  const toast = document.getElementById("answer-toast");
  const toastGo = document.getElementById("toast-go");
  const answerCard = document.getElementById("answer-card");
  function showToast(){
    toast.style.display = "flex";
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => hideToast(), 7000);
  }
  function hideToast(){ toast.style.display = "none"; }
  function isAnswerVisible(){
    const r = answerCard.getBoundingClientRect();
    const vh = window.innerHeight || document.documentElement.clientHeight;
    return (r.top < vh * 0.75) && (r.bottom > vh * 0.25);
  }
  function scrollToAnswer(){
    answerCard.scrollIntoView({ behavior: "smooth", block: "start" });
    hideToast();
  }
  toastGo.addEventListener("click", scrollToAnswer);
  window.addEventListener("scroll", () => {
    if (toast.style.display !== "none" && isAnswerVisible()) hideToast();
  }, { passive:true });

  let currentLevel = "lyceum";
  document.querySelectorAll(".level-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".level-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentLevel = btn.dataset.level;
    });
  });

  const mathInput = document.getElementById("math-input");
  const textInput = document.getElementById("text-input");
  const statusEl = document.getElementById("status");
  const answerEl = document.getElementById("ai-answer");
  const setStatus = (t="") => statusEl.textContent = t;

  /* âœ… NEW: clear buttons that work */
  document.getElementById("clear-math-btn").addEventListener("click", async () => {
    mathInput.value = "";
    await updateMathPreview();
    mathInput.focus();
  });

  document.getElementById("clear-text-btn").addEventListener("click", () => {
    textInput.value = "";
    textInput.focus();
  });

  function greekToEnglishMath(s){
    let t = (s || "").toString();
    t = t.replace(/Ï‡/g, "x").replace(/Î§/g, "x");
    t = t.replace(/âˆ’/g,'-').replace(/Ã·/g,'/').replace(/Ã—/g,'*');
    t = t.replace(/Î·Î¼\s*/g, "sin ");
    t = t.replace(/ÏƒÏ…Î½\s*/g, "cos ");
    t = t.replace(/ÎµÏ†\s*/g, "tan ");
    t = t.replace(/ÏƒÏ†\s*/g, "cot ");
    t = t.replace(/sinx/g, "sin x").replace(/cosx/g, "cos x").replace(/tanx/g, "tan x").replace(/cotx/g, "cot x");
    t = t.replace(/Ï€/g, "\\pi ");
    t = t.replace(/[ \t]+/g, " ").trim();
    return t;
  }

  const keyboardLayouts = {
    num: [['x','y','z','Ï€','e','7','8','9','Ã—','Ã·'],['xÂ²','xâ¿','a/b','âˆš','â¿âˆš','4','5','6','+','âˆ’'],['1','2','3','0','â‰¤','â‰¥','<','>'],['=',' ']],
    func: [['sin','cos','tan','ln','logâ‚â‚€','logâ‚bâ‚'],['sinâ»Â¹','cosâ»Â¹','tanâ»Â¹','d/dx','âˆ«','dx'],['sec(x)','csc(x)','Ï€âˆ«','{','}','â‰¤','â‰¥'],['=',' ']],
    abc: [['q','w','e','r','t','y','u','i','o','p'],['a','s','d','f','g','h','j','k','l'],['z','x','c','v','b','n','m','(',')'],['=',' ']],
    sym: [['#','&','Â¬','â‰ˆ','â‰ ','âˆ'],['â‰¤','â‰¥','âˆˆ','âˆ‰','â‡’','â‡”'],['âŠ‚','âŠ†','âŠ„','âŠ‡','|','â€–'],['=',' ']]
  };
  const keyboardRows = document.getElementById("keyboard-rows");

  function insertAtCursor(el, text){
    const start = el.selectionStart ?? el.value.length;
    const end = el.selectionEnd ?? el.value.length;
    el.setRangeText(text, start, end, "end");
    el.focus();
  }
  function insertFromKey(label){
    let insertText;
    if (label === ' ') insertText = ' ';
    else if (label === 'xÂ²') insertText = 'x^2';
    else if (label === 'xâ¿') insertText = 'x^';
    else if (label === 'a/b') insertText = '/';
    else if (label === 'ln') insertText = '\\ln(';
    else if (label === 'logâ‚â‚€') insertText = '\\log_{10}(';
    else if (label === 'logâ‚bâ‚') insertText = '\\log_{b}(';
    else if (label === 'âˆš') insertText = 'âˆš( )';
    else if (label === 'â¿âˆš') insertText = '3âˆš( )';
    else if (label === 'Ï€âˆ«') insertText = 'V = Ï€âˆ«_{a}^{b} f(x)^2 dx';
    else insertText = label;
    insertAtCursor(mathInput, insertText);
    updateMathPreview();
  }
  function loadKeyboard(name){
    keyboardRows.innerHTML = "";
    keyboardLayouts[name].forEach(row => {
      const wrap = document.createElement("div");
      row.forEach(label => {
        const b = document.createElement("button");
        b.className = "key"; b.type = "button";
        b.textContent = label === " " ? "ÎºÎµÎ½ÏŒ" : label;
        b.onclick = () => insertFromKey(label);
        wrap.appendChild(b);
      });
      keyboardRows.appendChild(wrap);
    });
  }
  document.querySelectorAll(".tab").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      loadKeyboard(btn.dataset.layout);
    });
  });
  loadKeyboard("num");

  const mathPreview = document.getElementById("math-preview");
  const mathPreviewPlaceholder = document.getElementById("math-preview-placeholder");

  function isProbablyLatex(s){ return /\\(frac|sqrt|int|sum|begin|pi|cdot|left|right|det|sin|cos|tan)/.test(s || ""); }

  function convertToLatex(text){
    let t = (text || "").trim();
    if (!t) return "";
    const alreadyLatex = isProbablyLatex(t);

    t = greekToEnglishMath(t);
    t = t.replace(/([0-9a-zA-Z\)\}])\s*:\s*([0-9a-zA-Z\\(\{])/g, '$1/$2');

    if (!alreadyLatex){
      t = t.replace(/âˆ«/g,'\\int ');
      t = t.replace(/\s*dx\b/g,'\\, dx');
      t = t.replace(/(\d+)\s*âˆš\s*\(([^)]*)\)/g,'\\sqrt[$1]{$2}');
      t = t.replace(/(\d+)\s*âˆš\s*([a-zA-Z0-9]+)/g,'\\sqrt[$1]{$2}');
      t = t.replace(/âˆš\s*\(([^)]*)\)/g,'\\sqrt{$1}');
      t = t.replace(/âˆš\s*([a-zA-Z0-9]+)/g,'\\sqrt{$1}');
      t = t.replace(/sqrt\s*\(([^)]*)\)/gi,'\\sqrt{$1}');
      t = t.replace(/([0-9a-zA-Z\\]+)\s*\^\s*\(([^)]+)\)/g,'$1^{ $2 }');
      t = t.replace(/([a-zA-Z0-9])\^(\d+)/g,'$1^{ $2 }');
      t = t.replace(/\(([^()]+)\)\s*\/\s*\(([^()]+)\)/g,'\\frac{$1}{$2}');
      t = t.replace(/([0-9a-zA-Z]+)\s*\/\s*\(([^()]+)\)/g,'\\frac{$1}{$2}');
      t = t.replace(/([0-9a-zA-Z])\s*\/\s*([0-9a-zA-Z])(?!\s*\^)/g,'\\frac{$1}{$2}');
    }
    t = t.replace(/\*/g,'\\cdot ');
    return t;
  }

  async function renderMathIn(el){
    if (window.MathJax && MathJax.typesetPromise){
      try { await MathJax.typesetPromise([el]); } catch(e){}
    }
  }

  async function updateMathPreview(){
    const raw = mathInput.value;
    if (!raw.trim()){
      mathPreview.innerHTML = "";
      mathPreviewPlaceholder.style.display = "inline";
      return;
    }
    mathPreviewPlaceholder.style.display = "none";
    const latex = convertToLatex(raw);
    mathPreview.innerHTML = `\\(${latex}\\)`;
    await renderMathIn(mathPreview);
  }
  mathInput.addEventListener("input", updateMathPreview);

  async function askAI(prompt){
    setStatus("Î¤Î¿ AI ÏƒÎºÎ­Ï†Ï„ÎµÏ„Î±Î¹â€¦");
    statusEl.classList.add("status-thinking");
    answerEl.innerHTML = "Î¤Î¿ AI ÏƒÎºÎ­Ï†Ï„ÎµÏ„Î±Î¹â€¦";
    await renderMathIn(answerEl);

    try{
      const res = await fetch(`${BASE_URL}/ask`, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ prompt })
      });
      const data = await res.json();
      const ans = data.answer || data.message || "Î”ÎµÎ½ Î®ÏÎ¸Îµ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·.";
      answerEl.innerHTML = String(ans).replace(/\n/g,"<br>");
      await renderMathIn(answerEl);
      if (!isAnswerVisible()) showToast();
    }catch(e){
      answerEl.innerHTML = "Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Îµ Ï„Î¿Î½ server (/ask).";
    }
    setStatus("");
    statusEl.classList.remove("status-thinking");
  }

  document.getElementById("ask-btn").addEventListener("click", async () => {
    hideToast();
    const mathRaw = mathInput.value.trim();
    const math = mathRaw ? greekToEnglishMath(mathRaw) : "";
    const text = textInput.value.trim();

    let bodyParts = [];
    if (math) bodyParts.push("ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ® Î­ÎºÏ†ÏÎ±ÏƒÎ·:\n" + math);
    if (text) bodyParts.push("Î›ÎµÎºÏ„Î¹ÎºÎ® Î±Ï€Î¿ÏÎ¯Î±:\n" + text);
    const mainPrompt = bodyParts.join("\n\n") || "Î›ÏÏƒÎµ Ï„Î¿ 1+1.";

    const levelPrefix = currentLevel === "lyceum"
      ? "ÎÎ± Î»Ï…Î¸ÎµÎ¯ Î¼Îµ Î¼Î±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ¬ ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… Î›Ï…ÎºÎµÎ¯Î¿Ï…. Î‘Ï€ÏŒÏ†Ï…Î³Îµ Ï€Î±Î½ÎµÏ€Î¹ÏƒÏ„Î·Î¼Î¹Î±ÎºÎ­Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚.\n\n"
      : "ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Ï€Î±Î½ÎµÏ€Î¹ÏƒÏ„Î·Î¼Î¹Î±ÎºÎ¿Ï ÎµÏ€Î¹Ï€Î­Î´Î¿Ï….\n\n";

    await askAI(levelPrefix + mainPrompt);
  });

  /* ===== INK MODAL (same as before) ===== */
  (function(){
    const $ = (id) => document.getElementById(id);

    const bd = $("ink-backdrop");
    const btnOpen = $("open-ink-btn");
    const btnClose = $("ink-close");

    const cMath = $("ink-math-canvas");
    const cText = $("ink-text-canvas");

    const colorEl = $("ink-color");
    const sizeEl = $("ink-size");
    const sizeVal = $("ink-size-val");

    const btnMathToMain = $("ink-math-to-main");
    const btnTextToMain = $("ink-text-to-main");
    const btnMathClear = $("ink-math-clear");
    const btnTextClear = $("ink-text-clear");

    const inkTransferStatus = $("ink-transfer-status");

    let ctxMath = null;
    let ctxText = null;
    let inkBusy = false;

    function setInkMsg(msg="", ok=true){
      if(!inkTransferStatus) return;
      inkTransferStatus.textContent = msg;
      inkTransferStatus.style.color = ok ? "#065f46" : "#dc2626";
    }

    function setInkStyle(ctx){
      if(!ctx) return;
      const color = colorEl?.value || "#111827";
      const size = Number(sizeEl?.value || 4);
      if(sizeVal) sizeVal.textContent = String(size);
      ctx.strokeStyle = color;
      ctx.lineWidth = size;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
    }

    function resizeCanvas(canvas){
      if(!canvas) return null;
      const wrap = canvas.closest(".ink-wrap");
      if(!wrap) return null;

      const rect = wrap.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;

      canvas.width  = Math.max(1, Math.floor(rect.width  * dpr));
      canvas.height = Math.max(1, Math.floor(rect.height * dpr));

      canvas.style.width  = rect.width + "px";
      canvas.style.height = rect.height + "px";

      const ctx = canvas.getContext("2d");
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      setInkStyle(ctx);
      return ctx;
    }

    function openInk(){
      setInkMsg("");
      bd.classList.add("show");
      bd.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
      ctxMath = resizeCanvas(cMath);
      ctxText = resizeCanvas(cText);
      setTimeout(() => btnClose?.focus(), 30);
    }

    function closeInk(){
      bd.classList.remove("show");
      bd.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
      inkBusy = false;
      unlockInkButtons();
    }

    function lockInkButtons(){
      inkBusy = true;
      btnMathToMain.disabled = true;
      btnTextToMain.disabled = true;
      btnMathClear.disabled = true;
      btnTextClear.disabled = true;
      btnClose.disabled = true;
    }
    function unlockInkButtons(){
      inkBusy = false;
      btnMathToMain.disabled = false;
      btnTextToMain.disabled = false;
      btnMathClear.disabled = false;
      btnTextClear.disabled = false;
      btnClose.disabled = false;
    }

    function clearCanvas(canvas, ctx){
      if(!canvas || !ctx) return;
      ctx.save();
      ctx.setTransform(1,0,0,1,0,0);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.restore();
    }

    function getPos(canvas, ev){
      const r = canvas.getBoundingClientRect();
      return { x: ev.clientX - r.left, y: ev.clientY - r.top };
    }

    function bindDraw(canvas, getCtx){
      let drawing = false;
      let activePointerId = null;
      let lastX = 0, lastY = 0;

      function start(ev){
        const ctx = getCtx();
        if(!ctx) return;
        if(activePointerId !== null && ev.pointerId !== activePointerId) return;
        activePointerId = ev.pointerId;
        drawing = true;
        setInkStyle(ctx);
        const p = getPos(canvas, ev);
        lastX = p.x; lastY = p.y;
        try{ canvas.setPointerCapture(ev.pointerId); }catch(e){}
        ev.preventDefault();
      }

      function move(ev){
        const ctx = getCtx();
        if(!ctx || !drawing || ev.pointerId !== activePointerId) return;
        const p = getPos(canvas, ev);
        const pressure = (typeof ev.pressure === "number" && ev.pressure > 0) ? ev.pressure : 0.5;
        const base = Number(sizeEl?.value || 4);
        ctx.lineWidth = base * (0.75 + pressure * 0.9);
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();
        lastX = p.x; lastY = p.y;
        ev.preventDefault();
      }

      function end(ev){
        if(ev.pointerId !== activePointerId) return;
        drawing = false;
        try{ canvas.releasePointerCapture(ev.pointerId); }catch(e){}
        activePointerId = null;
        ev.preventDefault();
      }

      canvas.addEventListener("pointerdown", start, {passive:false});
      canvas.addEventListener("pointermove", move, {passive:false});
      canvas.addEventListener("pointerup", end, {passive:false});
      canvas.addEventListener("pointercancel", end, {passive:false});
      canvas.addEventListener("pointerleave", end, {passive:false});
    }

    async function canvasToBlob(canvas){
      return await new Promise(resolve => canvas.toBlob(b => resolve(b), "image/png", 0.92));
    }

    function cleanRecognitionText(txt){
      const t = (txt || "").replace(/\r/g,"").trim();
      if(!t) return "";
      return t.split("\n").map(x=>x.trim()).filter(Boolean).slice(0,10).join("\n");
    }

    function appendAtCursor(el, text){
      const toAdd = (text || "").trim();
      if(!toAdd) return;
      if(el.value.includes(toAdd)) return;
      const start = el.selectionStart ?? el.value.length;
      const end = el.selectionEnd ?? el.value.length;
      const before = el.value.slice(0, start);
      const after  = el.value.slice(end);
      const needsNL = before && !before.endsWith("\n") && start === el.value.length;
      const insert = (needsNL ? "\n" : "") + toAdd;
      el.value = before + insert + after;
      const caret = (before + insert).length;
      el.setSelectionRange(caret, caret);
    }

    async function recognizeFromCanvas(canvas, kind){
      const blob = await canvasToBlob(canvas);
      if(!blob) return "";
      setInkMsg(kind === "math" ? "â³ Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· Î¼Î±Î¸Î·Î¼Î±Ï„Î¹ÎºÏÎ½â€¦" : "â³ Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï…â€¦", true);

      const prompt = (kind === "math")
        ? "Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎµ Ï„Î·Î½ ÎœÎ‘Î˜Î—ÎœÎ‘Î¤Î™ÎšÎ— Î•ÎšÎ¦Î¡Î‘Î£Î— Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î³ÏÎ±Î¼Î¼Î­Î½Î· ÏƒÏ„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î±.\nÎ•Î Î™Î£Î¤Î¡Î•Î¨Î• ÎœÎŸÎÎŸ Ï„Î·Î½ Î­ÎºÏ†ÏÎ±ÏƒÎ· ÏƒÎµ Î±Ï€Î»ÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ (Ï‡Ï‰ÏÎ¯Ï‚ ÎµÎ¾Î·Î³Î®ÏƒÎµÎ¹Ï‚).\nÎœÎ·Î½ Î³ÏÎ¬ÏˆÎµÎ¹Ï‚ Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚."
        : "Î”Î¹Î¬Î²Î±ÏƒÎµ Ï„Î¿ Ï‡ÎµÎ¹ÏÏŒÎ³ÏÎ±Ï†Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÏƒÏ„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î± ÎºÎ±Î¹ ÎµÏ€Î­ÏƒÏ„ÏÎµÏˆÎµ Ï„Î¿ Ï‰Ï‚ Î±Ï€Î»ÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿.\nÎ•Î Î™Î£Î¤Î¡Î•Î¨Î• ÎœÎŸÎÎŸ Ï„Î¿ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ (Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÏ‡ÏŒÎ»Î¹Î±).\nÎ‘Î½ Î´ÎµÎ½ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï„Î¯Ï€Î¿Ï„Î±, ÎµÏ€Î­ÏƒÏ„ÏÎµÏˆÎµ ÎºÎµÎ½ÏŒ.";

      const formData = new FormData();
      formData.append("image", new File([blob], kind === "math" ? "ink_math.png" : "ink_text.png", {type:"image/png"}));
      formData.append("question", prompt);
      formData.append("level", currentLevel);

      try{
        const res = await fetch(`${BASE_URL}/check-image`, { method:"POST", body: formData });
        const data = await res.json();
        return cleanRecognitionText(data.answer || "");
      }catch(e){
        setInkMsg("âŒ Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ (/check-image).", false);
        return "";
      }
    }

    btnOpen.addEventListener("click", openInk);
    btnClose.addEventListener("click", closeInk);
    bd.addEventListener("click", (e) => { if(e.target === bd) closeInk(); });

    window.addEventListener("keydown", (e) => {
      if(e.key === "Escape" && bd.classList.contains("show") && !inkBusy) closeInk();
    });

    window.addEventListener("resize", () => {
      if(bd.classList.contains("show")){
        ctxMath = resizeCanvas(cMath);
        ctxText = resizeCanvas(cText);
      }
    }, {passive:true});

    sizeEl.addEventListener("input", () => { setInkStyle(ctxMath); setInkStyle(ctxText); });
    colorEl.addEventListener("input", () => { setInkStyle(ctxMath); setInkStyle(ctxText); });

    btnMathClear.addEventListener("click", () => { if(inkBusy) return; clearCanvas(cMath, ctxMath); setInkMsg(""); });
    btnTextClear.addEventListener("click", () => { if(inkBusy) return; clearCanvas(cText, ctxText); setInkMsg(""); });

    btnMathToMain.addEventListener("click", async () => {
      if(inkBusy) return;
      lockInkButtons();
      try{
        const recognized = (await recognizeFromCanvas(cMath, "math")).trim();
        if(!recognized){ setInkMsg("âŒ Î”ÎµÎ½ Î±Î½Î±Î³Î½Ï‰ÏÎ¯ÏƒÏ„Î·ÎºÎµ Ï„Î¯Ï€Î¿Ï„Î±.", false); return; }
        const finalText = greekToEnglishMath(recognized);
        appendAtCursor(mathInput, finalText);
        await updateMathPreview();
        setInkMsg("âœ… Î ÎµÏÎ¬ÏƒÏ„Î·ÎºÎµ ÏƒÏ„Î· ÎœÎ±Î¸Î·Î¼Î±Ï„Î¹ÎºÎ® ÎˆÎºÏ†ÏÎ±ÏƒÎ·.", true);
        closeInk();
        mathInput.focus();
      } finally {
        unlockInkButtons();
      }
    });

    btnTextToMain.addEventListener("click", async () => {
      if(inkBusy) return;
      lockInkButtons();
      try{
        const recognized = (await recognizeFromCanvas(cText, "text")).trim();
        if(!recognized){ setInkMsg("âŒ Î”ÎµÎ½ Î±Î½Î±Î³Î½Ï‰ÏÎ¯ÏƒÏ„Î·ÎºÎµ Ï„Î¯Ï€Î¿Ï„Î±.", false); return; }
        if(textInput.value.includes(recognized)){ setInkMsg("â„¹ï¸ Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î· ÏƒÏ„Î· Î›ÎµÎºÏ„Î¹ÎºÎ®.", false); return; }
        const prefix = textInput.value.trim() ? "\n\n" : "";
        textInput.value = textInput.value + prefix + recognized;
        setInkMsg("âœ… Î ÎµÏÎ¬ÏƒÏ„Î·ÎºÎµ ÏƒÏ„Î· Î›ÎµÎºÏ„Î¹ÎºÎ® Î‘Ï€Î¿ÏÎ¯Î±.", true);
        closeInk();
        textInput.focus();
      } finally {
        unlockInkButtons();
      }
    });

    bindDraw(cMath, () => ctxMath);
    bindDraw(cText, () => ctxText);
  })();

  // Init
  updateMathPreview();
</script>

</body>
</html>
